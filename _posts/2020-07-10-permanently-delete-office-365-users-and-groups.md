---
layout: post
title: Permanently Delete Office 365 Users and Groups
date: 2020-07-10 12:00
author: beierca
comments: true
categories: [Azure, Azure AD, Office365, Powershell, recycle bin, Uncategorized, user deletion]
---
<p>Hi there</p><p>I got the following error trying to solve an issue this morning for a migration where the same username was being used with different UPN and as a guest account</p><ul><li><strong>thiago.beier</strong>@tecbis.com.br</li><li><strong>thiago.beier</strong>@#guestemail</li></ul><p><strong>The quick fix to these errors is:</strong></p><p>Permanent delete the user from recycle bin</p><p>Log on Office 365 tenant with PowerShell</p><p><em><strong>Connect-MsolService</strong></em></p><p>list all deleted users (user on recycle bin)</p><p><em><strong>Get-MsolUser –ReturnDeletedUsers | FL UserPrincipalName,ObjectID</strong></em></p><p>permanent delete all users from recycle bin</p><p><em><strong>Get-MsolUser –ReturnDeletedUsers | Remove-MsolUser –RemoveFromRecycleBin –Force</strong></em></p><p>I also cleaned up all deleted Groups we had on the Office 365 tenant as well</p><p><em><strong>Connect-AzureAD</strong></em></p><p>logged at your Office 365 tenant with Powershell (used to fix the deleted users before)</p><p>list all deleted groups</p><p><em><strong>Get-AzureADMSDeletedGroup </strong></em></p><p>permanent delete all groups from recycle bin</p><p><strong>Get-AzureADMSDeletedGroup | Remove-AzureADMSDeletedDirectoryObject</strong></p><p>Screenshots collected</p><p><span style="color:#ff0000;">Error trying to create a shared mailbox</span></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_183.png" /></p><p>Connect Office 365 - PowerShell and list deleted users (from recycle bin)</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_184.png" /></p><p>You might see this error / warning if the user thiago.beier appears with the same UPN (UserPrincipalName) more than once.</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_185.png" /></p><p>User the <strong>| FL UserPrincipalname,ObjectId</strong> to identify multiple entries</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_186.png" /></p><p>Now with the ObjectId you should be able to remove the proper user</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_187.png" /></p><p>You can also remove all thiago.beier (same UPN) @ all domains you might have on recycle bin</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_188.png" /></p><p>Listing all users by UPN and ObjectId</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_189.png" /></p><p><span style="color:#ff0000;">Nuke</span> them all if needed</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_201.png" /></p><p>Check for the deleted users at the Office 365 Portal</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_202.png" /></p><p>Working with deleted Groups</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_203.png" /></p><p><span style="color:#ff0000;">before</span></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_204.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_243.png" /></p><p><span style="color:#ff0000;">Nuke</span> them all running the following:</p><p>"<strong>Get-AzureADMSDeletedGroup | Remove-AzureADMSDeletedDirectoryObject</strong>"</p><p><span style="color:#ff0000;">after</span></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/o365/permdelete/Screenshot_242.png" /></p><p>&nbsp;</p><p><strong>References</strong></p><p>https://docs.microsoft.com/en-us/powershell/module/msonline/remove-msoluser?view=azureadps-1.0</p><p><strong><span style="color:#ff0000;">Check my <a style="color:#ff0000;" href="https://github.com/thiagobeier/scripts/blob/master/README.md"><span style="color:#0000ff;">Github</span></a> repository</span></strong></p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thanks,</p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thiago Beier<br /><a href="https://twitter.com/thiagobeier"><img title="Twitter" src="https://socialmediawidgets.files.wordpress.com/2014/03/twitter1.png" alt="Twitter" width="35" height="35" /></a><a href="https://www.linkedin.com/in/tbeier/"><img title="LinkedIn" src="https://socialmediawidgets.files.wordpress.com/2014/03/linkedin1.png" alt="LinkedIn" width="35" height="35" /></a><a href="https://www.facebook.com/TheBeier/"><img title="Facebook" src="https://socialmediawidgets.files.wordpress.com/2014/03/facebook1.png" alt="Facebook" width="35" height="35" /></a><a href="https://thiagobeier.wordpress.com/feed/"><img title="RSS" src="https://socialmediawidgets.files.wordpress.com/2014/03/rss1.png" alt="RSS" width="35" height="35" /></a></p>
