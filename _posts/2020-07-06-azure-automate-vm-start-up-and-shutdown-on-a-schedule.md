---
layout: post
title: Azure - automate VM start up and shutdown on a schedule
date: 2020-07-06 12:00
author: beierca
comments: true
categories: [Automation, Azure, azure powershell, Powershell, runbook]
---
<p><!-- wp:paragraph --></p><p>Hi there</p><p>in this article I'm covering how to save costs on your VM environment by scheduling a time to start and stop your VM on a schedule.</p><p><strong>Create an Azure Automation account</strong></p><ul><li>go to Azure Portal home \ marketplace \ search for automation</li><li>create an azure automation account</li><li>give it a name:</li><li>finish the wizard</li><li>wait until the azure automation account is created and go to the resource</li></ul><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_54.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_55.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_56.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_57.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_58.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_59.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_60.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_61.png" /></p><p><strong>Create and publish a runbook</strong></p><ul><li>go to Azure Portal home \ marketplace \ search for automation</li><li>go to your azure resource group</li><li>select the azure automation account you created</li><li>click on runbooks</li><li>click on create a runbook "+"</li><li>give it a name, at resource type select Powershell and give it a descripton and click create</li><li>at the next screen "cmdlets"</li><li>paste the following code (powershell commands that'll parse the VM name, Azure Resource group - where the vm is located and the parameters to start or stop the vm) than click save and publish</li></ul><pre class="line-numbers">Param(<br /> [string]$VmName,<br /> [string]$ResourceGroupName,<br /> [ValidateSet("Start", "Shutdown")]<br /> [string]$VmAction<br />)<br /># Authenticate Azure Automation Account<br />$Conn = Get-AutomationConnection -Name AzureRunAsConnection<br />Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `<br />-ApplicationID $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint<br /># Start VM<br />IF ($VmAction -eq "Start") {<br />    Start-AzureRmVM -Name $VmName -ResourceGroupName $ResourceGroupName<br />}<br /># Stop VM<br />IF ($VmAction -eq "Shutdown") {<br />    Stop-AzureRmVM -Name $VmName -ResourceGroupName $ResourceGroupName -Force<br />}</pre><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_62.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_63.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_64.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_65.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_66.png" /></p><p>&nbsp;</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_68.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_71.png" /></p><p><strong>Create your recurring schedule</strong></p><ul><li>under the runbook</li><li>select Schedules blade under Resources menuÂ </li><li>you need to create two different schecules one to start and another to stop the vm daily:<ul><li><strong>daily01</strong> : starts the vm daily at 9 AM EST on my scenario</li><li><strong>daily02</strong>: stops the vm daily at 6 PM EST <span style="color:var(--color-text);font-size:1rem;">on my scenario</span></li></ul></li></ul><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_72.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_73.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_74.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_75.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_76.png" /></p><p>&nbsp;</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_77.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_78.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_79.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_94.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_97.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_98.png" /></p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_99.png" /></p><p>Now wait until the time and date scheduled to next run to see it in action.</p><p><img style="max-width:100%;" src="https://thiagobeierblog.blob.core.windows.net/posts/azure/automation/1/Screenshot_101.png" /></p><p><strong><span style="color:#ff0000;">Check my <a style="color:#ff0000;" href="https://github.com/thiagobeier/scripts/blob/master/README.md"><span style="color:#0000ff;">Github</span></a> repository</span></strong></p><p><strong>References</strong><br /><a href="https://azure.microsoft.com/en-us/services/automation/" target="_blank" rel="noopener">https://azure.microsoft.com/en-us/services/automation/</a><br /><a href="https://docs.microsoft.com/en-us/azure/automation/" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/automation/</a><br /><a href="https://docs.microsoft.com/en-us/azure/automation/automation-runbook-types" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/automation/automation-runbook-types</a></p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thanks,</p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thiago Beier<br /><a href="https://twitter.com/thiagobeier"><img title="Twitter" src="https://socialmediawidgets.files.wordpress.com/2014/03/twitter1.png" alt="Twitter" width="35" height="35" /></a><a href="https://www.linkedin.com/in/tbeier/"><img title="LinkedIn" src="https://socialmediawidgets.files.wordpress.com/2014/03/linkedin1.png" alt="LinkedIn" width="35" height="35" /></a><a href="https://www.facebook.com/TheBeier/"><img title="Facebook" src="https://socialmediawidgets.files.wordpress.com/2014/03/facebook1.png" alt="Facebook" width="35" height="35" /></a><a href="https://thiagobeier.wordpress.com/feed/"><img title="RSS" src="https://socialmediawidgets.files.wordpress.com/2014/03/rss1.png" alt="RSS" width="35" height="35" /></a></p><p><!-- /wp:paragraph --></p>
