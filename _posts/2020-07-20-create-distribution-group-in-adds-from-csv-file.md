---
layout: post
title: Create Distribution Group in ADDS from CSV file.
date: 2020-07-20 13:00
author: beierca
comments: true
categories: [Active Directory, ADDS, Administration, Automation, distribution group, Powershell]
---
<p><!-- wp:paragraph --></p><p>Hi there</p><p>This article it's to show how to create DG (Distribution Groups) from CSV file into ADDS.</p><p>We got an export from Lotus Notes Distribution Group (same client) where we have:</p><ul><li>Group Name</li><li>Members: with CN and email (as contacts) on the same column </li></ul><p>Challenges</p><ul><li>create the Distribution Groups from CSV file (as is, with blank spaces on name)</li><li>import members into ADDS Distribution Groups</li><li>import contacts into ADDS Distribution Groups, based on the column A (group name) and column E (members)</li></ul><p><strong>Script #1 - Creating Distribution Groups in ADDS from CSV file</strong></p><pre>############################################################################################################################################################################################################################################### <br /># Author Thiago Beier thiago.beier@gmail.com <br /># Version: 1.0 - 2020-07-16 <br />#<br /># Create Distribution Groups in ADDS<br /># Create a DG if doesn't exist<br /># Create all DG with a prefix "D-CA-" from CSV file<br /># DG groups need mail and proxyaddresses attributes in AD to work after they're synced to AzureAD/Office365 tenant<br /># You can add, replace, remove any attribute as needeed.<br />#<br /># Toronto, CANADA <br /># Email: thiago.beier@gmail.com <br /># https://www.linkedin.com/in/tbeier/ <br /># https://twitter.com/thiagobeier <br /># https://thiagobeier.wordpress.com<br /><br />###############################################################################################################################################################################################################################################<br /><br />clear<br /><br />$dt=get-date -format yyyy-MM-dd-hhmm<br />Start-Transcript log-$dt.txt<br /><br />#$file=IMPORT-CSV .\dg1.csv<br />$file=IMPORT-CSV .\dgroups-members.csv<br /><br />$dgemail = $null<br />$dgname = $null<br />$groupobjid = $null<br /><br />FOREACH ($line in $file)<br />{<br /><br /><br />$dgemail = $line.email+"@thebeier.com"<br />#$dgemail<br />$dgname = "D-CA-"+$line.GroupName<br /><br />write-host "setting DG email address $dgemail to" $dgname -ForegroundColor Green <br /><br /># If the group exists, inform, if it does not exist also inform.<br /><br /><br />If (Get-ADGroup -Filter * | where {$_.Name -like $dgname}) <br /><br /><br />{<br /><br /><br />$dgname<br />Write-Host "$dgname already exists in Active Directory" -ForegroundColor Green<br /><br />$groupobjid = (Get-ADGroup -Filter * | where {$_.Name -like "$dgname"}).ObjectGUID<br />$groupobjid<br /><br />Set-ADGroup $dgname -Add @{mail = "$dgemail"}<br />Set-ADGroup $dgname -Add @{proxyAddresses = "SMTP:$dgemail"}<br /><br /><br />}<br />Else<br />{<br /><br />Write-Host "I am sorry, $dgname does not exist." -ForegroundColor RED<br /><br />$OUpath="OU=DistributionGroups,DC=thebeier,DC=local"<br />write-host "creating group:" $dgname -ForegroundColor Yellow<br /><br /><br />New-ADGroup -Name "$dgname" -SamAccountName "$dgname" -GroupCategory Distribution -GroupScope Universal -Path $OUpath -Description $line.Description<br />Set-ADGroup $dgname -Add @{mail = "$dgemail"}<br />Set-ADGroup $dgname -Add @{proxyAddresses = "SMTP:$dgemail"}<br /><br />}<br /><br />}<br /><br /><br />Stop-Transcript</pre><p>Wait for the next script! <strong><span style="color:#ff0000;">Import Contacts into ADDS from CSV file </span></strong> Coming soon.</p><p><strong><span style="color:#ff0000;">Check my <a style="color:#ff0000;" href="https://github.com/thiagobeier/scripts/blob/master/README.md"><span style="color:#0000ff;">Github</span></a> repository</span></strong></p><p>Check this script and the CSV file example <a href="https://github.com/thiagobeier/scripts/tree/master/30" target="_blank" rel="noopener">here</a>.</p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thanks,</p><p><!-- /wp:paragraph -->

<!-- wp:paragraph --></p><p>Thiago Beier<br /><a href="https://twitter.com/thiagobeier"><img title="Twitter" src="https://socialmediawidgets.files.wordpress.com/2014/03/twitter1.png" alt="Twitter" width="35" height="35" /></a><a href="https://www.linkedin.com/in/tbeier/"><img title="LinkedIn" src="https://socialmediawidgets.files.wordpress.com/2014/03/linkedin1.png" alt="LinkedIn" width="35" height="35" /></a><a href="https://www.facebook.com/TheBeier/"><img title="Facebook" src="https://socialmediawidgets.files.wordpress.com/2014/03/facebook1.png" alt="Facebook" width="35" height="35" /></a><a href="https://thiagobeier.wordpress.com/feed/"><img title="RSS" src="https://socialmediawidgets.files.wordpress.com/2014/03/rss1.png" alt="RSS" width="35" height="35" /></a></p><p><!-- /wp:paragraph --></p>
